\subsection{RBF-based quadrature}\label{sec:rbf-quadrature}

Our approach to generating quadrature weights $\weight[j]$ for numerical integration on an immersed structure
$\interface$ (such as RBCs and platelets) at the spreading points $\Xsj$ is to first precompute a fixed set of
quadrature weights $\omega_j$ on $\sphere$, then map these weights to $\interface$ during each time-step. For the
following discussion, note that $\weight[j](\theta, \varphi, t)$ is technically a function of time $t$, since
$\interface$ moves in time. However, for brevity, we suppress the arguments for the weights.

First, we discuss how to compute RBF-based meshless quadrature weights on $\sphere$. Given a function
$\psi:\sphere\to\R$ and a radial kernel $\phi:\sphere\times\sphere\to\R$, we now wish to find a set of quadrature
weights $\omega_j$ such that
\begin{equation}\label{eq:quad-desire}
    \int\limits_{\sphere} \psi(\Xp) \d\Xp \approx \sum_{j=1}^{\sample\cardinality} \omega_j \psi(\Xpsj).
\end{equation}
We use a variant of the technique described by Fuselier \latin{et al.}~\cite{Fuselier:2013coba}.  Choosing
$\psi(\Xp) = \phi(\|\Xp-\sample\Xp_i\|)$ for each $\sample\Xp_i$,~\eqref{eq:quad-desire} becomes
\begin{equation}
    \sum_{j=1}^{\sample\cardinality} \omega_j \phi(\|\Xpsj-\sample\Xp_i\|)
    \approx \int\limits_{\sphere}\phi(\|\Xp-\sample\Xp_i\|) \d\Xp := \L\phi|_{\sample\Xp_i}.
    \label{eq:cond1t}
\end{equation}
However, because
\begin{equation}
    \|\Xp-\sample\Xp_i\|^2
        = (\Xp-\sample\Xp_i)\cdot(\Xp-\sample\Xp_i)
        = 2 - 2\Xp\cdot\sample\Xp_i
\end{equation}
depends only on the angle between the two points, $\L\phi$ is constant over the sphere. We therefore expect the
right-hand side to be a constant, which we denote $-I_\phi$. We require further that the $\omega_j$ sum to the
surface area of $\sphere$, \latin{i.e.},
\begin{equation}\label{eq:weight-sum}
    \sum_{j=1}^{\sample\cardinality} \omega_j  = 4\pi.
\end{equation}
Treating $I_\phi$ as an unknown scalar, we rewrite the constraints~\eqref{eq:cond1t} and~\eqref{eq:weight-sum} in
the symmetric block linear system
\begin{equation}\label{eq:rbf-quadrature}
    \begin{bmatrix}
            \Phi & \arr{1} \\ \arr{1}^T & 0
    \end{bmatrix}\begin{bmatrix}
            \arr{\omega} \\ I_\phi
    \end{bmatrix} = \begin{bmatrix}
            \arr{0} \\ 4\pi
    \end{bmatrix},
\end{equation}
where $\arr{\omega}$ are the unknown weights, $\Phi$ represents the evaluations of $\phi$, and $\arr{0}$ and
$\arr{1}$ are vectors of $\sample\cardinality$ zeros and ones, respectively. $I_{\phi}$ serves as a Lagrange
multiplier that enforces~\eqref{eq:weight-sum}, and $-I_\phi$ is a good approximation to $\L\phi$. By choosing
$\phi(r) = r$, we guarantee a unique solution and obtain weights that we observe to converge at
3\textsuperscript{rd} order. It is possible to improve the order of the quadrature weights by increasing the order
of the PHS RBF at the potential cost of poorer conditioning and either loss of invertibility or requiring
knowledge of higher-order moments~\cite{Fuselier:2013coba}.

Once the quadrature weights $\omega_j$, $j=1, \ldots, \sample\cardinality$ are computed, it is straightforward to
compute the corresponding quadrature weights $\weight[j]$, $j=1, \ldots, \sample\cardinality$ for integration at
the spreading points $\sample\X \in \interface(t)$. Recall that $\interface$ has parametrization
$\X(\theta, \varphi, t)$ and Jacobian $J(\theta, \varphi)$ for a given time t. This implies that the point
$\X(\theta, \varphi)$ directly corresponds to to $\Xp(\theta, \varphi)$. Using this fact and the fact that the
determinant of the Jacobian for the spherical coordinate mapping (for radius 1) is $\cos\varphi$, we can use a
change of variables to express the infinitesimal area $\d\X$ on $\interface$ as
\begin{equation}\label{eq:quad-cov}
    \d\X
    = J(\theta, \varphi)\d\qs
    = J(\theta, \varphi)\sec\varphi\d\Xp,
\end{equation}
where $\d\qs$ is an infinitesimal area in parameter space. Note that the weights $\omega_j$ above are discrete
analogs of $\d\Xp$ at $\Xpsj$. The discrete analog of $\d\qs$ at the $j^\text{th}$ sample site,
\begin{equation}
    \sigma_j=\sec\varphi_j\omega_j,
\end{equation}
can therefore be computed at the outset of a simulation. To avoid numerical issues, we require that
$\cos\varphi_j \neq 0$ for each sample site. This is true everywhere on $\sphere$ except the poles,
$(0, 0, \pm1)$, which the Bauer spiral~\eqref{eq:bauer-spiral} conveniently avoids. Finally, the quadrature weight
$\weight[j]$ for $\interface$ at the spreading point $\Xsj$ is given by
\begin{equation}
    \weight[j] = \sigma_j J_j,
\end{equation}
where $J_j = J(\theta_j, \varphi_j)$. Computing $\weight[j]$ given $\sigma_j$ and $J_j$ amounts to a single
multiplication, which can be done trivially in parallel. This produces a set of (time-varying) weights
$\weight[j]$, $j=1, \ldots, \sample\cardinality$ that allows us to integrate functions on $\interface(t)$ when
their samples are given at $\Xsj$, $j=1, \ldots, \sample\cardinality$, as required by~\eqref{eq:ib-spread-disc}.
